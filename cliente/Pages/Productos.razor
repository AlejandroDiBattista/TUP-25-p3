#nullable enable
#nullable restore
@page "/productos"
@inject Services.ProductoService ProductoService
@inject Services.CarritoService CarritoService

<h3>Lista de Productos</h3>

@if (productos is null)
{
    <p>Cargando productos...</p>
}
else
{
    <ul>
        @foreach (var producto in productos)
        {
            <li>
                @producto.Nombre - $@producto.Precio
                <button @onclick="() => AgregarAlCarrito(producto.Id)">Agregar al carrito</button>
            </li>
        }
    </ul>
}

@code {
    private List<Dtos.ProductoDto>? productos;

    protected override async Task OnInitializedAsync()
    {
        productos = await ProductoService.ObtenerProductos();
    }

    private async Task AgregarAlCarrito(int productoId)
    {
        var producto = productos?.FirstOrDefault(p => p.Id == productoId);
        if (producto != null)
        {
            await CarritoService.AgregarProducto(producto.Id);
        }
    }
}
