@using cliente.Shared
@using cliente.Services
@inherits LayoutComponentBase
@inject CarritoService CarritoService

<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">
            <i class="bi bi-cart3"></i> Mi tienda
        </a>
        <div class="ms-auto">
            <a href="/carrito" class="btn position-relative">
                <i class="bi bi-cart3" style="font-size: 1.5rem;"></i>
                @if (carritoCantidad > 0)
                {
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        @carritoCantidad
                    </span>
                }
            </a>
        </div>
    </div>
</nav>

<div class="container" style="margin-top: 80px;">
    @Body
</div>

@code {
    private int carritoCantidad = 0;

    protected override async Task OnInitializedAsync()
    {
        await CarritoService.InitializeCarrito();
        await ActualizarContadorCarrito();
    }

    public async Task ActualizarContadorCarrito()
    {
        var carrito = await CarritoService.GetCarritoAsync();
        carritoCantidad = carrito.Items?.Sum(i => i.Cantidad) ?? 0;
        StateHasChanged();
    }
}