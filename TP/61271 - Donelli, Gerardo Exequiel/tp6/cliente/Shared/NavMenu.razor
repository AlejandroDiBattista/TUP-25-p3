@inject CarritoService CarritoService
@inject NavigationManager NavigationManager

@*
    Componente de navegación principal de la aplicación.
    Muestra el logo, buscador y carrito con contador de items.
*@

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="bi bi-shop me-2"></i>
            Tienda Online
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <div class="d-flex flex-grow-1 justify-content-center">
                <div class="search-container">
                    <input class="form-control" 
                           type="search" 
                           placeholder="Buscar productos..." />
                </div>
            </div>

            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/carrito">
                        <i class="bi bi-cart3"></i>
                        @if (CarritoService.ObtenerCantidadTotal() > 0)
                        {
                            <span class="badge bg-primary rounded-pill">@CarritoService.ObtenerCantidadTotal()</span>
                        }
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

@code {
    /// <summary>
    /// Se ejecuta cuando se inicializa el componente.
    /// Suscribe al evento OnChange del CarritoService para actualizar el contador.
    /// </summary>
    protected override void OnInitialized()
    {
        CarritoService.OnChange += StateHasChanged;
    }

    /// <summary>
    /// Se ejecuta cuando se destruye el componente.
    /// Desuscribe del evento OnChange para evitar memory leaks.
    /// </summary>
    public void Dispose()
    {
        CarritoService.OnChange -= StateHasChanged;
    }
}
