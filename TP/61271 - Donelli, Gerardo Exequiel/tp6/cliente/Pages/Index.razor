@page "/"
@using cliente.Models
@using cliente.Services

<PageTitle>Cat√°logo - Tienda Online</PageTitle>

<div class="container py-4">
    <div class="row">
        @if (productos == null)
        {
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
            </div>
        }
        else if (!productos.Any())
        {
            <div class="col-12">
                <div class="alert alert-info">
                    No se encontraron productos @(!string.IsNullOrEmpty(textoBusqueda) ? $"para \"{textoBusqueda}\"" : "")
                </div>
            </div>
        }
        else
        {
            @foreach (var producto in productos)
            {
                <div class="col-12 col-sm-6 col-lg-4 col-xl-3 mb-4">
                    <TarjetaProducto Producto="producto" />
                </div>
            }
        }
    </div>
</div>

@code {
    private List<ProductoDTO> productos;
    private string textoBusqueda = "";

    [Inject]
    public ProductosService ProductosService { get; set; }

    [CascadingParameter]
    public MainLayout Layout { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await BuscarProductos("");
    }

    private async Task BuscarProductos(string texto)
    {
        textoBusqueda = texto;
        productos = await ProductosService.ObtenerProductos(texto);
    }
}
