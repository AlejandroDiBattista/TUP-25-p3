<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora React</title>

    <style>
      body {
        margin: 0;
        background: #fcd9a0;
        font-family: sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .phone {
        background: black;
        border-radius: 40px;
        padding: 20px;
        width: 300px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
      }

      .screen {
        color: white;
        text-align: right;
        font-size: 48px;
        padding: 20px 10px;
        min-height: 60px;
      }

      .buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }

      .btn {
        font-size: 24px;
        border: none;
        border-radius: 50%;
        padding: 20px;
        cursor: pointer;
        color: white;
      }

      .gray {
        background: #a5a5a5;
        color: black;
      }

      .dark {
        background: #333;
      }

      .orange {
        background: #ff9500;
      }

      .btn.zero {
        grid-column: span 2;
        border-radius: 40px;
        text-align: left;
        padding-left: 30px;
      }
    </style>
  </head>
  <body>
    <div class="phone">
      <div id="root"></div>
    </div>
    <script
      crossorigin
      src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"
    ></script>
    <!-- Babel para JSX en el navegador -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <script type="text/babel">
      const { useState } = React;

      function Calculadora() {
        const [input, setInput] = useState("");

        const operadores = ["+", "-", "*", "/", "%"];

        function evaluarExpresion(expresion) {
          try {
            const tokens = expresion.match(/(\d+(\.\d+)?|[+\-*/%])/g);
            if (!tokens) return "Error";

            const toNumber = (val) => parseFloat(val);

            for (let i = 0; i < tokens.length; i++) {
              if (["*", "/", "%"].includes(tokens[i])) {
                const op = tokens[i];
                const a = toNumber(tokens[i - 1]);
                const b = toNumber(tokens[i + 1]);

                if (op === "/" && b === 0) return "Error";

                let res;
                switch (op) {
                  case "*":
                    res = a * b;
                    break;
                  case "/":
                    res = a / b;
                    break;
                  case "%":
                    res = a % b;
                    break;
                }

                tokens.splice(i - 1, 3, res.toString());
                i -= 1;
              }
            }

            let resultado = toNumber(tokens[0]);
            for (let i = 1; i < tokens.length; i += 2) {
              const op = tokens[i];
              const num = toNumber(tokens[i + 1]);
              if (op === "+") resultado += num;
              if (op === "-") resultado -= num;
            }

            return resultado.toString();
          } catch {
            return "Error";
          }
        }

        const handleClick = (value) => {
          if (value === "AC") {
            setInput("");
            return;
          }

          if (value === "+/-") {
            if (!input) return;
            const resultado = evaluarExpresion(input);
            if (resultado !== "Error") {
              setInput((-1 * parseFloat(resultado)).toString());
            }
            return;
          }

          if (value === "=") {
            const resultado = evaluarExpresion(input);
            setInput(resultado);
            return;
          }

          if (operadores.includes(value)) {
            const ultimo = input.slice(-1);
            if (input === "" && value !== "-") return;
            if (operadores.includes(ultimo)) return;
          }

          if (value === ".") {
            const partes = input.split(/[\+\-\*\/]/);
            const ultimaParte = partes[partes.length - 1];
            if (ultimaParte.includes(".")) return;
          }

          setInput((prev) => prev + value);
        };

        const botones = [
          ["AC", "+/-", "%", "/"],
          ["7", "8", "9", "*"],
          ["4", "5", "6", "-"],
          ["1", "2", "3", "+"],
          ["0", ".", "="],
        ];

        const getClass = (value) => {
          if (["AC", "+/-", "%"].includes(value)) return "btn gray";
          if (["/", "*", "-", "+", "="].includes(value)) return "btn orange";
          return "btn dark";
        };

        return (
          <>
            <div className="screen">{input || "0"}</div>
            <div className="buttons">
              {botones.flat().map((btn, i) => (
                <button
                  key={i}
                  className={`${getClass(btn)} ${btn === "0" ? "zero" : ""}`}
                  onClick={() => handleClick(btn)}
                >
                  {btn}
                </button>
              ))}
            </div>
          </>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<Calculadora />);
    </script>
  </body>
</html>
