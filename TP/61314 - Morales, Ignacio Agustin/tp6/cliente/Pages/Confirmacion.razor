@using System.ComponentModel.DataAnnotations
@page "/confirmacion"
@inject NavigationManager Navigation

<h2 class="titulo-confirmacion">Confirmación de Compra</h2>

@if (carrito.Count == 0)
{
    <p>No hay productos en el carrito.</p>
}
else
{
    <div class="resumen-compra">
        <p><strong>Total de productos:</strong> @carrito.Sum(i => i.Cantidad)</p>
        <p><strong>Importe total:</strong> $@carrito.Sum(i => i.Producto.Precio * i.Cantidad)</p>
    </div>

    <EditForm Model="formulario" OnValidSubmit="ConfirmarCompra">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="formulario">
            <label>Nombre:</label>
            <InputText @bind-Value="formulario.Nombre" />
            <ValidationMessage For="@(() => formulario.Nombre)" />

            <label>Apellido:</label>
            <InputText @bind-Value="formulario.Apellido" />
            <ValidationMessage For="@(() => formulario.Apellido)" />

            <label>Email:</label>
            <InputText @bind-Value="formulario.Email" />
            <ValidationMessage For="@(() => formulario.Email)" />
        </div>

        <button type="submit" class="boton-confirmar">Confirmar compra</button>
    </EditForm>
}

@code {
    public class ProductoDto
    {
        public int Id { get; set; }
        public string Nombre { get; set; }
        public decimal Precio { get; set; }
    }

    public class ItemCarrito
    {
        public ProductoDto Producto { get; set; }
        public int Cantidad { get; set; }
    }

    public class FormularioCompra
    {
        [Required]
        public string Nombre { get; set; }
        [Required]
        public string Apellido { get; set; }
        [Required, EmailAddress]
        public string Email { get; set; }
    }

    List<ItemCarrito> carrito = new()
    {
        new ItemCarrito { Producto = new ProductoDto { Id = 1, Nombre = "iPhone 15", Precio = 780000 }, Cantidad = 1 },
        new ItemCarrito { Producto = new ProductoDto { Id = 5, Nombre = "AirPods Pro", Precio = 200000 }, Cantidad = 2 }
    };

    FormularioCompra formulario = new();

    void ConfirmarCompra()
    {
        // Aquí podrías llamar a tu backend: PUT /carritos/{id}/confirmar
        carrito.Clear(); // Simula vaciar carrito tras compra
        Navigation.NavigateTo("/catalogo");
    }
}
